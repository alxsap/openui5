<!DOCTYPE html>
<html lang="en">

<head><meta charset="utf-8">
	<title>Separate the Configuration file</title>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script data-require-ui5-init src="../../../scripts/boot.js"></script>
</head>

<body class="sapUiBody sapUiSizeCompact topicBody">
	<div class="topic">
		<div class="content">
			<h1 id="overview">Separate the Configuration file</h1>
			<p>
				Sometimes there are too many fields in the configuration, and hard to management.
				We may want to separate them into several json files, then load them into the configuration file.
				<br>Also, we may need to load some js files in configuration file too.
				<br>Then we can separate the Configuration file.
			</p>
			<h2 id="separateFields">Separate the fields into several json files</h2>
			<p>
				First, separate the fields into sevaral json files as wanted.
			</p>
			<pre class="lang-js">
{
	&quot;generalGroup&quot;: {
		&quot;type&quot;: &quot;group&quot;,
		&quot;label&quot;: &quot;All Data Type&quot;,
		&quot;expanded&quot;: false,
		&quot;hint&quot;: &quot;Please refer to the <a href="https://www.sap.com">documentation</a> lets see how this will behave if the text is wrapping to the next line and has <a href="https://www.sap.com">two links</a>. good?&quot;
	},
	&quot;cardTitle&quot;: {
		&quot;manifestpath&quot;: &quot;/sap.card/configuration/parameters/cardTitle/value&quot;,
		&quot;type&quot;: &quot;string&quot;,
		&quot;translatable&quot;: true,
		&quot;required&quot;: true,
		&quot;label&quot;: &quot;cardTitle&quot;,
		&quot;allowDynamicValues&quot;: true,
		&quot;editableToUser&quot;: false,
		&quot;visibleToUser&quot;: true,
		&quot;description&quot;: &quot;Card Title&quot;,
		&quot;cols&quot;: 1,
		// js file
		&quot;testJS&quot;: &quot;sap/ui5/test/editor/listcard/dt/TestJs1&quot;,
		&quot;hint&quot;: &quot;Please refer to the <a href="https://www.sap.com">documentation</a> lets see how this will behave if the text is wrapping to the next line and has <a href="https://www.sap.com">two links</a>. good?&quot;
	},
	&quot;stringWithTextArea&quot;: {
		&quot;manifestpath&quot;: &quot;/sap.card/configuration/parameters/stringWithTextArea/value&quot;,
		&quot;type&quot;: &quot;string&quot;,
		&quot;label&quot;: &quot;Use TextArea for a string field&quot;,
		// js file
		&quot;testJS&quot;: &quot;sap/ui5/test/editor/listcard/dt/TestJs2&quot;,
		&quot;visualization&quot;: {
			&quot;type&quot;: &quot;TextArea&quot;,
			&quot;settings&quot;: {
				&quot;value&quot;: &quot;{currentSettings&gt;value}&quot;,
				&quot;width&quot;: &quot;100%&quot;,
				&quot;editable&quot;: &quot;{config/editable}&quot;,
				&quot;placeholder&quot;: &quot;{currentSettings&gt;placeholder}&quot;,
				&quot;rows&quot;: 7
			}
		}
	},
	&quot;stringLabelTrans&quot;: {
		&quot;manifestpath&quot;: &quot;/sap.card/configuration/parameters/stringLabelTrans/value&quot;,
		&quot;type&quot;: &quot;string&quot;,
		&quot;label&quot;: &quot;{i18n&gt;TRANSLATED_STRING_LABEL}&quot;,
		// js file
		&quot;testJS&quot;: &quot;sap/ui5/test/editor/listcard/dt/TestJs3&quot;,
		&quot;cols&quot;: 2,
		&quot;translatable&quot;: true,
		&quot;allowDynamicValues&quot;: false
	},
	&quot;stringLabelTrans2&quot;: {
		&quot;manifestpath&quot;: &quot;/sap.card/configuration/parameters/stringLabelTrans2/value&quot;,
		&quot;type&quot;: &quot;string&quot;,
		&quot;label&quot;: &quot;{{TRANSLATED_STRING_LABEL}}&quot;,
		&quot;translatable&quot;: true,
		&quot;allowDynamicValues&quot;: false,
		&quot;description&quot;: &quot;A very long description text that should wrap into the next line&quot;
	},
	&quot;stringWithTranslatedValue&quot;: {
		&quot;manifestpath&quot;: &quot;/sap.card/configuration/parameters/stringWithTranslatedValue/value&quot;,
		&quot;type&quot;: &quot;string&quot;,
		&quot;label&quot;: &quot;String with translated value&quot;,
		&quot;translatable&quot;: true
	},
	&quot;stringWithTranslatedValueIni18nFormat&quot;: {
		&quot;manifestpath&quot;: &quot;/sap.card/configuration/parameters/stringWithTranslatedValueIni18nFormat/value&quot;,
		&quot;type&quot;: &quot;string&quot;,
		&quot;label&quot;: &quot;String with translated value in i18n format&quot;
	}
}
</pre>
			<h2 id="prepareJSFiles">Prepare the JS files loaded by Configuration file</h2>
			<p>
				Prepare the JS files which will be loaded by Configuration file. You can define it in the above json file.
			</p>
			<pre class="lang-js">
sap.ui.define([
	&quot;sap/ui/integration/Designtime&quot;,
	&quot;sap/ui/thirdparty/jquery&quot;,
	&quot;sap/base/util/merge&quot;
], function (
	Designtime,
	jQuery,
	merge
) {
	&quot;use strict&quot;;
	return function (sTestName) {
		return sTestName + &quot; value 1&quot;;
	};
});
</pre>
			<h2 id="create">Create the configuration</h2>
			<p>
				Create the configuration as below:
			</p>
			<pre class="lang-js">
sap.ui.define([&quot;sap/ui/integration/Designtime&quot;], function (
	Designtime
) {
	&quot;use strict&quot;;
	return function () {
		var oDesigntime = new Designtime({
			&quot;form&quot;: {
				&quot;items&quot;: {
				}
			},
			&quot;preview&quot;: {
				&quot;modes&quot;: &quot;Abstract&quot;
			}
		});
		oDesigntime._readyPromise = function (oCardInterface, oInternalCard) {
			this.onCardReady(oCardInterface, oInternalCard);
			//this promise can be used to later on to load the editors and create ui, before we tell the consumer
			//to continue after the loadDesigntime.
			return Promise.resolve();
		};
		return oDesigntime;
	};
});
</pre>
			<h2 id="override">Override the function _readyPromise of Configuration</h2>
			<p>
				Override the function _readyPromise of Configuration, loading the json files in it, then save the fields as settings.form.items of the Configuration.
				Also loading the js files as wanted.
			</p>
<pre class="lang-js">
oDesigntime._readyPromise = function (oCardInterface, oInternalCard) {
	var that = this;
	that.onCardReady(oCardInterface, oInternalCard);
	var aJsonFiles = [
		&quot;dt/items1.json&quot;,
		&quot;dt/items2.json&quot;,
		&quot;dt/items3.json&quot;
	];
	var aPromises = [];
	aJsonFiles.forEach(function (sFileName) {
		// the prefix of the json files should match the id in manifest.json
		// &quot;id&quot;: &quot;sap.ui5.test.editor.listcard&quot;
		var sItemsPath = sap.ui.require.toUrl(&quot;sap/ui5/test/editor/listcard/&quot; + sFileName);
		aPromises.push(
			new Promise(function (resolve, reject) {
				jQuery.ajax(sItemsPath, {
					dataType: &quot;json&quot;
				}).done(function (oItems) {
					resolve(oItems);
				}).fail(function (jqXHR, sTextStatus, sError) {
					reject();
				});
			})
		);
	});
	var createPromise = function(oItem, n) {
		return new Promise(function (res) {
			sap.ui.require([oItem.testJS], function(n, testJS) {
				// process with the js file after loading it
				var newValue = testJS(n);
				this.testValue = newValue;
				res();
			}.bind(oItem, n));
		});
	};
	// load json files
	return Promise.all(aPromises).then(function (aItems) {
		var items1 = aItems[0],
			items2 = aItems[1],
			items3 = aItems[2];
		var oItems = merge(items1, items2, items3);
		that.settings.form.items = oItems;
	}).then(function () {
		aPromises = [];
		// create promises for loading js files
		for (var n in that.settings.form.items) {
			var oItem = that.settings.form.items[n];
			if (oItem.testJS &amp;&amp; oItem.testJS !== &quot;&quot;) {
				aPromises.push(
					createPromise(oItem, n)
				);
			}
		}
		if (aPromises.length &gt; 0) {
			// loading js files
			return Promise.all(aPromises);
		} else {
			return Promise.resolve();
		}
	});
};
</pre>
		</div>
	</div>
</body>

</html>